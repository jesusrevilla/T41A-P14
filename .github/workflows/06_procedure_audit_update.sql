CREATE OR REPLACE PROCEDURE actualizar_precio_auditado( IN p_id INT, IN p_nuevo_precio NUMERIC ) LANGUAGE plpgsql AS $$ DECLARE v_precio_anterior NUMERIC; BEGIN SELECT precio INTO v_precio_anterior FROM productos WHERE id = p_id; IF NOT FOUND THEN RAISE NOTICE 'Producto con ID % no encontrado.', p_id; RETURN; END IF; IF p_nuevo_precio <= 0 THEN RAISE NOTICE 'El precio debe ser mayor que 0.'; RETURN; END IF; UPDATE productos SET precio = p_nuevo_precio WHERE id = p_id; INSERT INTO auditoria_precios(id_producto, precio_anterior, precio_nuevo) VALUES (p_id, v_precio_anterior, p_nuevo_precio); RAISE NOTICE 'Precio actualizado y registrado en auditorÃ­a.'; END; $$;
